<!-- Critical Performance Optimizations for Mobile -->
<link rel="preload" href="/assets/images/website_image_compressed.webp" as="image" type="image/webp">
<link rel="preload" href="/assets/css/main.css" as="style">

<!-- Font Display Optimization -->
<style>
/* Force font-display: swap for all fonts to prevent layout shift */
@font-face {
  font-family: system-ui;
  font-display: swap;
}

/* Critical above-the-fold CSS inline to prevent render blocking */
body {
  font-display: swap;
}

/* Fix major CLS issues from Lighthouse report */
.page__hero--overlay {
  min-height: 400px; /* Prevent layout shift */
  background-color: #000 !important; /* Ensure consistent background */
}

.wrapper {
  contain: layout; /* Prevent layout shifts in wrapper */
}

.initial-content {
  contain: layout; /* Prevent layout shifts in main content */
}

/* Fix unsized image elements causing CLS */
.masthead__menu-item img,
img[alt="Junk Store"] {
  width: 48px;
  height: 48px;
}

/* FontAwesome font display optimization */
.fas, .far, .fab, .fa {
  font-display: swap !important;
}

/* Roboto and Lato font optimization */
.page, body, .initial-content {
  font-display: swap;
}

.page__hero {
  background-image: url('/assets/images/website_image_compressed.webp');
  background-size: cover;
  background-position: center;
}

/* WebP support check with fallback */
.no-webp .page__hero {
  background-image: url('/assets/images/website_image_compressed.webp');
}
</style>

<!-- Preconnect to external domains to reduce latency -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://www.googletagmanager.com">

<!-- WebP Support Detection -->
<script>
(function() {
  var webP = new Image();
  webP.onload = webP.onerror = function () {
    if (webP.height !== 2) {
      document.documentElement.classList.add('no-webp');
    }
  };
  webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
})();
</script>

<!-- Deferred JavaScript Loading -->
<script>
// Defer non-critical JavaScript until after page load
window.addEventListener('load', function() {
  // Load analytics and other non-critical scripts
  var scripts = [
    '/assets/js/conversion-tracking.js'
  ];
  
  scripts.forEach(function(src) {
    var script = document.createElement('script');
    script.src = src;
    script.async = true;
    document.head.appendChild(script);
  });
});
</script>